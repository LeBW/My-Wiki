# 四种引用类型
在 Java 语言中，除了基本数据类型外，其他的都是指向各类的对象引用；Java 中根据其生命周期的长短，将引用分为 4 类：强引用，软引用，弱引用，幻象引用（虚引用）。

## 强引用
我们平时编码 `Object obj = new Object()` 中的 `obj` 就是强引用。通过关键字 new 创建的对象所关联的引用就是强引用。

当 JVM 内存空间不足，JVM 宁愿抛出 OutOfMemoryError 运行时错误（OOM），使程序异常终止，也不会靠随意回收具有强引用的“存活”对象来解决内存不足的问题。

对于一个普通的对象，如果没有其他的引用关系，只要超过了引用的作用域或者显示地将相应（强）引用赋值为 null，就是可以被垃圾回收的了，而其具体垃圾回收时机还需要看垃圾回收策略。

## 软引用
软引用通过 `SoftReference` 类实现。软引用的生命周期比强引用短一些。

只有当 JVM 认为内存不足时，才会去试图回收软引用指向的对象：即 JVM 会确保在抛出 OutOfMemoryError 之前，清理软引用指向的对象。 

软引用可以和一个引用队列（ReferenceQueue）联合使用，如果软引用所指向的对象被垃圾回收器回收，Java 虚拟机就会把这个软引用加入到与之关联的引用队列中。
后续，我们可以通过调用 `ReferenceQueue` 中的 `poll()` 方法来检查是否有它关心的对象被回收。如果队列为空，将返回一个 null，否则该方法返回队列中前面的一个 Reference 对象。

应用场景：软引用通常用来实现内存敏感的缓存。如果还有内存空闲，就可以暂时保留缓存；当内存不足时清理掉。这里就保证了使用缓存的同时，不会耗尽内存。

## 弱引用
弱引用通过 `WeakReference` 类实现。弱引用的生命周期比软引用更短。

在垃圾回收器扫描它所管理的内存区域的过程中，一旦发现了具有弱引用的对象，不管当前内存空间是否足够，都会回收它的内存。

由于垃圾回收器是一个优先级很低的线程，因此不一定会很快回收弱引用的对象。

弱引用可以和一个引用队列（ReferenceQueue）联合使用，如果弱引用所指向的对象被垃圾回收器回收，Java 虚拟机就会把这个弱引用加入到与之关联的引用队列中。

应用场景：弱引用同样可以应用在内存敏感的缓存中。

## 幻象引用（虚引用）
幻象引用也叫虚引用，通过 `PhantomReference` 类来实现。

我们无法通过虚引用访问对象的任何属性和方法。虚引用仅仅提供了一种确保对象被 finalize 之后，做某些事的机制。

如果一个对象仅持有虚引用，那么它和没有任何引用一样，在任何时候都可能会垃圾回收器回收。

虚引用必须和引用队列（ReferenceQueue）联合使用。当垃圾回收器准备回收一个对象时，如果发现它还有虚引用，就会在回收对象的内存之前，把这个虚引用加入到与之关联的引用队列中。

```java
ReferenceQueue queue = new ReferenceQueue();
PhantomReference pr = new PhantomReference(object, queue);
```

程序可以通过判断引用队列中是否已经加入了虚引用，来了解被引用对象是否将要被垃圾回收。如果程序发现某个虚引用已经被加入到引用队列，那么就可以在所引用的对象在被垃圾回收之前采取一些行动。

应用场景：可以用来跟踪对象被垃圾回收器回收的活动，当一个虚引用指向的对象被垃圾回收器回收之前，可以收到一条系统通知。