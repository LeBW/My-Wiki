<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>文件系统 | LBW&#39;s Wiki Pages</title>
    <meta name="description" content="Organize all of my knowledge.">
    <link rel="icon" href="/wiki/lbw-wiki.png">
    
    <link rel="preload" href="/wiki/assets/css/0.styles.08165e7c.css" as="style"><link rel="preload" href="/wiki/assets/js/app.4bef6644.js" as="script"><link rel="preload" href="/wiki/assets/js/2.cf9cdfbc.js" as="script"><link rel="preload" href="/wiki/assets/js/8.1aac9bd4.js" as="script"><link rel="prefetch" href="/wiki/assets/js/10.21428617.js"><link rel="prefetch" href="/wiki/assets/js/11.305ab435.js"><link rel="prefetch" href="/wiki/assets/js/12.44dedbbb.js"><link rel="prefetch" href="/wiki/assets/js/13.5a16190a.js"><link rel="prefetch" href="/wiki/assets/js/14.45a791c6.js"><link rel="prefetch" href="/wiki/assets/js/15.f59573f6.js"><link rel="prefetch" href="/wiki/assets/js/16.ac8fba95.js"><link rel="prefetch" href="/wiki/assets/js/17.5f4f935b.js"><link rel="prefetch" href="/wiki/assets/js/18.2225503b.js"><link rel="prefetch" href="/wiki/assets/js/19.c6fac61a.js"><link rel="prefetch" href="/wiki/assets/js/20.06c5ffb6.js"><link rel="prefetch" href="/wiki/assets/js/21.117b74c8.js"><link rel="prefetch" href="/wiki/assets/js/22.c760fb7f.js"><link rel="prefetch" href="/wiki/assets/js/23.8411097f.js"><link rel="prefetch" href="/wiki/assets/js/24.2969b567.js"><link rel="prefetch" href="/wiki/assets/js/25.99b320a7.js"><link rel="prefetch" href="/wiki/assets/js/26.745055d5.js"><link rel="prefetch" href="/wiki/assets/js/27.6b434e2a.js"><link rel="prefetch" href="/wiki/assets/js/28.01c73e87.js"><link rel="prefetch" href="/wiki/assets/js/29.ff28199e.js"><link rel="prefetch" href="/wiki/assets/js/3.90941938.js"><link rel="prefetch" href="/wiki/assets/js/30.8cbf2a52.js"><link rel="prefetch" href="/wiki/assets/js/31.538d2df0.js"><link rel="prefetch" href="/wiki/assets/js/32.2bb9d0ce.js"><link rel="prefetch" href="/wiki/assets/js/33.be2ee12e.js"><link rel="prefetch" href="/wiki/assets/js/34.9ddb4f0d.js"><link rel="prefetch" href="/wiki/assets/js/35.8a1cc0da.js"><link rel="prefetch" href="/wiki/assets/js/36.ae8a8334.js"><link rel="prefetch" href="/wiki/assets/js/37.d7b50fda.js"><link rel="prefetch" href="/wiki/assets/js/38.c4605dec.js"><link rel="prefetch" href="/wiki/assets/js/39.70d1f597.js"><link rel="prefetch" href="/wiki/assets/js/4.a1b7b08c.js"><link rel="prefetch" href="/wiki/assets/js/40.914a9d99.js"><link rel="prefetch" href="/wiki/assets/js/5.1559a922.js"><link rel="prefetch" href="/wiki/assets/js/6.03e09e9c.js"><link rel="prefetch" href="/wiki/assets/js/7.2f1bf81e.js"><link rel="prefetch" href="/wiki/assets/js/9.aeb063fb.js">
    <link rel="stylesheet" href="/wiki/assets/css/0.styles.08165e7c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wiki/" class="home-link router-link-active"><!----> <span class="site-name">LBW's Wiki Pages</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wiki/overview/" class="nav-link">概览</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/algorithm/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/wiki/operating-system/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/wiki/computer-network/" class="nav-link">计算机网路</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/language/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/wiki/language/c/" class="nav-link">C/C++</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/backend/tomcat/" class="nav-link">Tomcat</a></li><li class="dropdown-item"><!----> <a href="/wiki/backend/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/wiki/backend/database/" class="nav-link">数据库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/wiki/kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/frontend/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/wiki/linux/" class="nav-link router-link-active">Linux</a></li><li class="dropdown-item"><!----> <a href="/wiki/dev-ops/" class="nav-link">Dev-Ops</a></li></ul></div></div><div class="nav-item"><a href="https://lebw.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/lebw/my-wiki" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wiki/overview/" class="nav-link">概览</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/algorithm/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/wiki/operating-system/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/wiki/computer-network/" class="nav-link">计算机网路</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/language/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/wiki/language/c/" class="nav-link">C/C++</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/backend/tomcat/" class="nav-link">Tomcat</a></li><li class="dropdown-item"><!----> <a href="/wiki/backend/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/wiki/backend/database/" class="nav-link">数据库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/wiki/kubernetes/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/frontend/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/wiki/linux/" class="nav-link router-link-active">Linux</a></li><li class="dropdown-item"><!----> <a href="/wiki/dev-ops/" class="nav-link">Dev-Ops</a></li></ul></div></div><div class="nav-item"><a href="https://lebw.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/lebw/my-wiki" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/wiki/linux/sed.html" class="sidebar-link">sed 命令</a></li><li><a href="/wiki/linux/file-system.html" class="active sidebar-link">文件系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wiki/linux/file-system.html#利用fdisk对硬盘重新分区" class="sidebar-link">利用fdisk对硬盘重新分区</a></li><li class="sidebar-sub-header"><a href="/wiki/linux/file-system.html#扩大文件系统" class="sidebar-link">扩大文件系统</a></li><li class="sidebar-sub-header"><a href="/wiki/linux/file-system.html#lvm-logical-volume-manager" class="sidebar-link">LVM (Logical Volume Manager)</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="文件系统"><a href="#文件系统" aria-hidden="true" class="header-anchor">#</a> 文件系统</h1> <p>本节记录 Linux 操作系统中的文件系统相关概念和操作。</p> <h2 id="利用fdisk对硬盘重新分区"><a href="#利用fdisk对硬盘重新分区" aria-hidden="true" class="header-anchor">#</a> 利用fdisk对硬盘重新分区</h2> <p>fdisk是操作硬盘分区表的工具。输入<code>fdisk /dev/vda</code>以对该硬盘进行分区操作.输出为：</p> <div class="language- extra-class"><pre class="language-text"><code>[root@virt2 ~]# fdisk /dev/vda
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): m
Command action
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   delete a partition
   g   create a new empty GPT partition table
   G   create an IRIX (SGI) partition table
   l   list known partition types
   m   print this menu
   n   add a new partition
   o   create a new empty DOS partition table
   p   print the partition table
   q   quit without saving changes
   s   create a new empty Sun disklabel
   t   change a partition's system id
   u   change display/entry units
   v   verify the partition table
   w   write table to disk and exit
   x   extra functionality (experts only)
</code></pre></div><p>在输入m后得到了操作表。首先我们输入p以查看当前的分区表。</p> <div class="language- extra-class"><pre class="language-text"><code>Command (m for help): p

Disk /dev/vda: 214.7 GB, 214748364800 bytes, 419430400 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000c411d

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1   *        2048    62916607    31457280   83  Linux
/dev/vda2        62916608    67108863     2096128   82  Linux swap / Solaris

Command (m for help):
</code></pre></div><p>在这里我们发现问题：
硬盘容量有 214.7GB，但是分区1仅仅使用 30GB，分区2仅仅使用 2GB，也就是说还有很大一部分的硬盘容量没有利用起来。于是这里我们需要对硬盘重新分区。</p> <p>首先使用d命令删除当前的两个分区表</p> <div class="language- extra-class"><pre class="language-text"><code>Command (m for help): d
Partition number (1,2, default 2):
Partition 2 is deleted

Command (m for help): d
Selected partition 1
Partition 1 is deleted

Command (m for help):
</code></pre></div><p>然后使用n命令新建两个分区表。与之前一样，一个用来当启动分区，一个用于交换。由于一共有200G空间，我决定给启动分区184G的空间，交换分区16G的空间。关于交换分区的大小，可以参考<a href="https://www.tldp.org/HOWTO/Partition/requirements.html#SwapSize" target="_blank" rel="noopener noreferrer">此文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>分区1创建过程如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-419430399, default 2048):
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-419430399, default 419430399): +184G
Partition 1 of type Linux and of size 184 GiB is set

</code></pre></div><p>其中的技巧是使用<code>+184G</code>来指定分区大小，从而让fdisk为我们计算结束扇区。</p> <p>分区二创建过程如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Command (m for help): n
Partition type:
   p   primary (1 primary, 0 extended, 3 free)
   e   extended
Select (default p): p
Partition number (2-4, default 2): 2
First sector (385878016-419430399, default 385878016):
Using default value 385878016
Last sector, +sectors or +size{K,M,G} (385878016-419430399, default 419430399):
Using default value 419430399
Partition 2 of type Linux and of size 16 GiB is set
</code></pre></div><p>其中无需更改扇区结束处，因为fdisk默认会使用所有未分配的容量。</p> <p>同时，因为此分区用于交换，我们需要修改改分区的system ID。</p> <p>输入t后，指定分区2，然后可以输入L来显示所有的ID以供参考。我们可以看到82代表了Linux Swap。所以我们将其修改为82. 过程如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Command (m for help): t
Partition number (1,2, default 2): 2
Hex code (type L to list all codes): L

 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris
 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-
 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-
 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-
 4  FAT16 &lt;32M      40  Venix 80286     85  Linux extended  c7  Syrinx
 5  Extended        41  PPC PReP Boot   86  NTFS volume set da  Non-FS data
 6  FAT16           42  SFS             87  NTFS volume set db  CP/M / CTOS / .
 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility
 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt
 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access
 a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O
 b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor
 c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs
 e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT
 f  W95 Ext'd (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/
10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b
11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor
12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor
14  Hidden FAT16 &lt;3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary
16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS
17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE
18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto
1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep
1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT
1e  Hidden W95 FAT1 80  Old Minix
Hex code (type L to list all codes): 82
Changed type of partition 'Linux' to 'Linux swap / Solaris'
</code></pre></div><p>到这里分区的删除、重新创建就已经结束了。最后一定要注意使用w命令将其写入硬盘，否则所有的修改都是无效的。</p> <div class="language- extra-class"><pre class="language-text"><code>Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.

WARNING: Re-reading the partition table failed with error 16: Device or resource busy.
The kernel still uses the old table. The new table will be used at
the next reboot or after you run partprobe(8) or kpartx(8)
Syncing disks.
</code></pre></div><p>最后<code>sudo reboot</code>重启机器，以应用新的分区表。</p> <p>重启后使用<code>fdisk -l</code>命令发现，新的分区表已经生成成功。</p> <div class="language- extra-class"><pre class="language-text"><code>[root@virt2 ~]# fdisk -l

Disk /dev/vda: 214.7 GB, 214748364800 bytes, 419430400 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000c411d

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1            2048   385878015   192937984   83  Linux
/dev/vda2       385878016   419430399    16776192   82  Linux swap / Solaris
</code></pre></div><h2 id="扩大文件系统"><a href="#扩大文件系统" aria-hidden="true" class="header-anchor">#</a> 扩大文件系统</h2> <p>对硬盘重新分区后，使用<code>df -hT</code> 查看文件系统时，发现事情没有这么简单...</p> <div class="language- extra-class"><pre class="language-text"><code>[root@virt2 ~]# df -hT
Filesystem     Type      Size  Used Avail Use% Mounted on
/dev/vda1      ext4       30G  1.5G   27G   6% /
devtmpfs       devtmpfs   16G     0   16G   0% /dev
tmpfs          tmpfs      16G     0   16G   0% /dev/shm
tmpfs          tmpfs      16G  8.6M   16G   1% /run
tmpfs          tmpfs      16G     0   16G   0% /sys/fs/cgroup
tmpfs          tmpfs     3.2G     0  3.2G   0% /run/user/0
</code></pre></div><p>在这里，/dev/vda1分区的容量还是只有30G. 这是因为改变的是分区大小，而其对应的文件系统不会自动改变容量，需要继续进行相关操作来扩大文件系统的容量。</p> <p>在网上搜集相关资料后，发现一个相关命令<code>resize2fs</code>. 通过<code>man resize2fs</code>命令发现了一段关键信息：</p> <div class="language- extra-class"><pre class="language-text"><code>If you wish to enlarge a filesystem, you must make sure you can expand the  size of  the  underlying partition first. 
This can be done using fdisk(8) by deleting the partition and recreating it with a larger size or using lvex-tend(8), 
if you're using the logical volume manager lvm(8).  
When recreating the partition, make sure you create it with  the  same  starting  disk cylinder as before!
Otherwise, the resize operation will certainly not work, and you may lose your entire filesystem. 
After running fdisk(8),run resize2fs to resize the ext2 filesystem to use all of the space in the newly enlarged partition.
</code></pre></div><p>这里说的意思是：如果你想要扩大文件系统的容量，首先需要确保你可以扩大其对应的磁盘分区容量.（可以使用<code>fdisk</code>命令来删除并重新创建分区；而如果你使用lvm的话，需要使用<code>lvextend</code>命令）。
然后，对于 <code>ext2/3/4</code> 类型的文件系统，可以使用 <code>resize2fs</code>来改变文件系统容量。</p> <p>所以我输入命令 <code>resize2fs /dev/vda1</code> 成功得扩大了文件系统容量。</p> <div class="language- extra-class"><pre class="language-text"><code>[root@virt2 ~]# resize2fs /dev/vda1
resize2fs 1.42.9 (28-Dec-2013)
Filesystem at /dev/vda1 is mounted on /; on-line resizing required
old_desc_blocks = 4, new_desc_blocks = 23
The filesystem on /dev/vda1 is now 48234496 blocks long.

</code></pre></div><p>然后用 <code>df -hT</code>来查看文件系统</p> <div class="language- extra-class"><pre class="language-text"><code>[root@virt2 ~]# df -hT
Filesystem     Type      Size  Used Avail Use% Mounted on
/dev/vda1      ext4      181G  1.5G  172G   1% /
devtmpfs       devtmpfs   16G     0   16G   0% /dev
tmpfs          tmpfs      16G     0   16G   0% /dev/shm
tmpfs          tmpfs      16G  8.6M   16G   1% /run
tmpfs          tmpfs      16G     0   16G   0% /sys/fs/cgroup
tmpfs          tmpfs     3.2G     0  3.2G   0% /run/user/0
</code></pre></div><p>发现已经成功扩容。</p> <p>最后使用<code>mkswap /dev/vda2 &amp;&amp; swapon /dev/vda2</code> 使用swap交换。</p> <h2 id="lvm-logical-volume-manager"><a href="#lvm-logical-volume-manager" aria-hidden="true" class="header-anchor">#</a> LVM (Logical Volume Manager)</h2> <p>LVM是 逻辑卷管理（Logical Volume Manager）的简写，它是 Linux 环境下对磁盘分区管理的一种机制。</p> <p>在以上系统中，文件系统（File System）直接建立于硬盘分区（Partition）上。而这种方式下，由于硬盘分区在确定后很难更改大小，所以文件系统的大小也很难在运行时改变大小（尤其是减小）。如果在使用过程中发现文件系统容量不够，需要随机应变时，这种简单的磁盘分区管理机制就无法满足要求了。</p> <p>因此完美地解决方法应该是在零停机前提下可以自如地对文件系统对大小进行调整，可以方便地实现文件系统跨越不同磁盘和分区。LVM机制就是这样一种方案。</p> <p>LVM本质上是一个虚拟设备驱动，是在内核中块设备和物理设备之间添加的一个新的抽象层次，如图所示。
<img src="/wiki/assets/img/lvm.144fbc44.png" alt="lvm"></p> <ul><li>PV（Physical Volume)：物理卷，处于LVM的最底层，可以是硬盘分区、整个硬盘、元设备或者回送文件(loopback file)。</li> <li>VG（Volume Group)：卷组，建立在PV之上，可以含有一个到多个PV。</li> <li>LV（Logical Volume）：逻辑卷，建立在VG之上，相当于原来分区的概念。优点是灵活，大小可以动态改变，并且不需要在物理上连续，甚至可以跨硬盘。</li></ul> <p>使用LVM的基本步骤如下：</p> <ol><li>如果有必要的话，安装新的硬盘。</li> <li>选做：为硬盘进行分区。</li> <li>使用<code>pvcreate</code>命令将硬盘或者分区创建成为LVM管理的物理卷。</li> <li>使用<code>vgcreate</code>创建新的卷组或者使用<code>vgextend</code>将PV加入现有的卷组。</li> <li>使用<code>lvcreate</code>在VG上创建新的逻辑卷。</li> <li>使用<code>mkfs</code>在逻辑卷上创建新的文件系统。</li> <li>在<code>/etc/fstab</code>中写入相应条目，将文件系统 mount 在合适的目录下。</li> <li>mount 文件系统。</li></ol> <h3 id="举例"><a href="#举例" aria-hidden="true" class="header-anchor">#</a> 举例</h3> <p>假设现在安装了一块新的硬盘<code>/dev/hdd</code>，可以通过以下操作创建新的文件系统。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># create new PV from hard drive.</span>
pvcreate /dev/hdd
<span class="token comment"># add PV to existing volume group</span>
vgextend /dev/MyVG01 /dev/hdd
<span class="token comment"># create a logical volume</span>
lvcreate -L 50G --name Stuff MyVG01
<span class="token comment"># create a file system</span>
<span class="token function">mkfs</span> -t ext4 /dev/MyVG01/Stuff
<span class="token comment"># add a file system label</span>
e2label /dev/MyVG01/Stuff Stuff
<span class="token comment"># mount the file system</span>
<span class="token comment"># add an apporiate entry to /etc/fstab </span>
<span class="token comment"># use df, lvs, vgs to check.</span>
</code></pre></div><p>假设想要为文件系统扩容，在为VG添加了PV后：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># extend the logical volume</span>
lvextend -L 50G /dev/MyVG01/Stuff
<span class="token comment"># expand teh file system</span>
resize2fs /dev/MyVG01/Stuff
<span class="token comment"># check </span>
<span class="token function">df</span> -hT
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/wiki/linux/sed.html" class="prev">
          sed 命令
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/wiki/assets/js/app.4bef6644.js" defer></script><script src="/wiki/assets/js/2.cf9cdfbc.js" defer></script><script src="/wiki/assets/js/8.1aac9bd4.js" defer></script>
  </body>
</html>
