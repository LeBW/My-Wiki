<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>进程与线程 | LBW&#39;s Wiki Pages</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/lbw-wiki.png">
    <meta name="description" content="Organize all of my knowledge.">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.6eab1976.js" as="script"><link rel="preload" href="/assets/js/2.167d90c7.js" as="script"><link rel="preload" href="/assets/js/21.fec0ccc6.js" as="script"><link rel="prefetch" href="/assets/js/10.1ec14536.js"><link rel="prefetch" href="/assets/js/100.d3be4e1b.js"><link rel="prefetch" href="/assets/js/101.971eb1f4.js"><link rel="prefetch" href="/assets/js/102.2ae2fa3b.js"><link rel="prefetch" href="/assets/js/11.ec909d32.js"><link rel="prefetch" href="/assets/js/12.75d6c1db.js"><link rel="prefetch" href="/assets/js/13.fafebc4f.js"><link rel="prefetch" href="/assets/js/14.7da14f0a.js"><link rel="prefetch" href="/assets/js/15.0e8dd2a9.js"><link rel="prefetch" href="/assets/js/16.d9b44fc4.js"><link rel="prefetch" href="/assets/js/17.7a43f1b2.js"><link rel="prefetch" href="/assets/js/18.c16ff94e.js"><link rel="prefetch" href="/assets/js/19.4052930d.js"><link rel="prefetch" href="/assets/js/20.c97d4e30.js"><link rel="prefetch" href="/assets/js/22.b13a8b79.js"><link rel="prefetch" href="/assets/js/23.60db8c03.js"><link rel="prefetch" href="/assets/js/24.0eb76eee.js"><link rel="prefetch" href="/assets/js/25.9bbc378a.js"><link rel="prefetch" href="/assets/js/26.d71f4e99.js"><link rel="prefetch" href="/assets/js/27.51cc4dbb.js"><link rel="prefetch" href="/assets/js/28.984bcad5.js"><link rel="prefetch" href="/assets/js/29.23b6a9b4.js"><link rel="prefetch" href="/assets/js/3.91689c96.js"><link rel="prefetch" href="/assets/js/30.b9b53754.js"><link rel="prefetch" href="/assets/js/31.9ee2b382.js"><link rel="prefetch" href="/assets/js/32.aa1e7d4d.js"><link rel="prefetch" href="/assets/js/33.95599c18.js"><link rel="prefetch" href="/assets/js/34.91eec23a.js"><link rel="prefetch" href="/assets/js/35.842185fd.js"><link rel="prefetch" href="/assets/js/36.645d08e2.js"><link rel="prefetch" href="/assets/js/37.d2e53880.js"><link rel="prefetch" href="/assets/js/38.1401a1a9.js"><link rel="prefetch" href="/assets/js/39.6c0d3d3c.js"><link rel="prefetch" href="/assets/js/4.09a575dd.js"><link rel="prefetch" href="/assets/js/40.4038c6d1.js"><link rel="prefetch" href="/assets/js/41.43ae76f7.js"><link rel="prefetch" href="/assets/js/42.1aaebfeb.js"><link rel="prefetch" href="/assets/js/43.c98f9509.js"><link rel="prefetch" href="/assets/js/44.97a11a85.js"><link rel="prefetch" href="/assets/js/45.fc75f295.js"><link rel="prefetch" href="/assets/js/46.d2a82b99.js"><link rel="prefetch" href="/assets/js/47.90b9a3ec.js"><link rel="prefetch" href="/assets/js/48.a5f20f35.js"><link rel="prefetch" href="/assets/js/49.95d58daf.js"><link rel="prefetch" href="/assets/js/5.face5c6e.js"><link rel="prefetch" href="/assets/js/50.4a946785.js"><link rel="prefetch" href="/assets/js/51.74ef85d1.js"><link rel="prefetch" href="/assets/js/52.ab75e264.js"><link rel="prefetch" href="/assets/js/53.04e9a209.js"><link rel="prefetch" href="/assets/js/54.83caae44.js"><link rel="prefetch" href="/assets/js/55.0d6ab8db.js"><link rel="prefetch" href="/assets/js/56.8f313634.js"><link rel="prefetch" href="/assets/js/57.8e9ec077.js"><link rel="prefetch" href="/assets/js/58.445e1ec2.js"><link rel="prefetch" href="/assets/js/59.a81cf678.js"><link rel="prefetch" href="/assets/js/6.9b742511.js"><link rel="prefetch" href="/assets/js/60.0983c596.js"><link rel="prefetch" href="/assets/js/61.34edaa63.js"><link rel="prefetch" href="/assets/js/62.3c1dcc60.js"><link rel="prefetch" href="/assets/js/63.ca5ecc69.js"><link rel="prefetch" href="/assets/js/64.3d87faf8.js"><link rel="prefetch" href="/assets/js/65.bd56dfe3.js"><link rel="prefetch" href="/assets/js/66.ab87e244.js"><link rel="prefetch" href="/assets/js/67.e35259f3.js"><link rel="prefetch" href="/assets/js/68.ec2588e7.js"><link rel="prefetch" href="/assets/js/69.b13a6cfd.js"><link rel="prefetch" href="/assets/js/7.e41a37eb.js"><link rel="prefetch" href="/assets/js/70.8739c828.js"><link rel="prefetch" href="/assets/js/71.a694ddca.js"><link rel="prefetch" href="/assets/js/72.fe3bf48b.js"><link rel="prefetch" href="/assets/js/73.57026e0a.js"><link rel="prefetch" href="/assets/js/74.39a6f866.js"><link rel="prefetch" href="/assets/js/75.8d49462e.js"><link rel="prefetch" href="/assets/js/76.f891bf45.js"><link rel="prefetch" href="/assets/js/77.c8a3af4c.js"><link rel="prefetch" href="/assets/js/78.07521a97.js"><link rel="prefetch" href="/assets/js/79.aee888a3.js"><link rel="prefetch" href="/assets/js/8.f616a798.js"><link rel="prefetch" href="/assets/js/80.cfd0cd53.js"><link rel="prefetch" href="/assets/js/81.707a5ee3.js"><link rel="prefetch" href="/assets/js/82.791bd9b0.js"><link rel="prefetch" href="/assets/js/83.d2599399.js"><link rel="prefetch" href="/assets/js/84.e4773484.js"><link rel="prefetch" href="/assets/js/85.72f88fa5.js"><link rel="prefetch" href="/assets/js/86.ffdf2d1e.js"><link rel="prefetch" href="/assets/js/87.b4227711.js"><link rel="prefetch" href="/assets/js/88.ced4d671.js"><link rel="prefetch" href="/assets/js/89.7ceb6053.js"><link rel="prefetch" href="/assets/js/9.581e98ff.js"><link rel="prefetch" href="/assets/js/90.f1b678cb.js"><link rel="prefetch" href="/assets/js/91.8d1d690b.js"><link rel="prefetch" href="/assets/js/92.867a487f.js"><link rel="prefetch" href="/assets/js/93.49f36484.js"><link rel="prefetch" href="/assets/js/94.8ebd746e.js"><link rel="prefetch" href="/assets/js/95.bc94dbc7.js"><link rel="prefetch" href="/assets/js/96.fb0c9c67.js"><link rel="prefetch" href="/assets/js/97.3ab234c0.js"><link rel="prefetch" href="/assets/js/98.96a4f503.js"><link rel="prefetch" href="/assets/js/99.087cd15a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">LBW's Wiki Pages</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/overview/" class="nav-link">
  概览
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/operating-system/" class="nav-link router-link-active">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/computer-network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/distributed-system/" class="nav-link">
  分布式系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/language/c/" class="nav-link">
  C/C++
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/tomcat/" class="nav-link">
  Tomcat
</a></li><li class="dropdown-item"><!----> <a href="/backend/jetty/" class="nav-link">
  Jetty
</a></li><li class="dropdown-item"><!----> <a href="/backend/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/backend/database/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/backend/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><span class="title">微服务</span> <span class="arrow down"></span></button> <button type="button" aria-label="微服务" class="mobile-dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/microservice/" class="nav-link">
  微服务架构
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/kubernetes/" class="nav-link">
  Kubernetes
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/" class="nav-link">
  Dev-Ops
</a></li><li class="dropdown-item"><!----> <a href="/circumvent-internet/" class="nav-link">
  科学上网
</a></li></ul></div></div><div class="nav-item"><a href="https://lebw.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/lebw/my-wiki" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/overview/" class="nav-link">
  概览
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/operating-system/" class="nav-link router-link-active">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/computer-network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/distributed-system/" class="nav-link">
  分布式系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/language/c/" class="nav-link">
  C/C++
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/tomcat/" class="nav-link">
  Tomcat
</a></li><li class="dropdown-item"><!----> <a href="/backend/jetty/" class="nav-link">
  Jetty
</a></li><li class="dropdown-item"><!----> <a href="/backend/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/backend/database/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/backend/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><span class="title">微服务</span> <span class="arrow down"></span></button> <button type="button" aria-label="微服务" class="mobile-dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/microservice/" class="nav-link">
  微服务架构
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/kubernetes/" class="nav-link">
  Kubernetes
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/" class="nav-link">
  Dev-Ops
</a></li><li class="dropdown-item"><!----> <a href="/circumvent-internet/" class="nav-link">
  科学上网
</a></li></ul></div></div><div class="nav-item"><a href="https://lebw.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/lebw/my-wiki" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/operating-system/process.html" aria-current="page" class="active sidebar-link">进程与线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operating-system/process.html#线程" class="sidebar-link">线程</a></li><li class="sidebar-sub-header"><a href="/operating-system/process.html#地址空间" class="sidebar-link">地址空间</a></li><li class="sidebar-sub-header"><a href="/operating-system/process.html#进程" class="sidebar-link">进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operating-system/process.html#为什么使用进程" class="sidebar-link">为什么使用进程？</a></li></ul></li><li class="sidebar-sub-header"><a href="/operating-system/process.html#上下文切换" class="sidebar-link">上下文切换</a></li><li class="sidebar-sub-header"><a href="/operating-system/process.html#linux-中创建进程" class="sidebar-link">Linux 中创建进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operating-system/process.html#fork" class="sidebar-link">fork</a></li><li class="sidebar-sub-header"><a href="/operating-system/process.html#vfork" class="sidebar-link">vfork</a></li><li class="sidebar-sub-header"><a href="/operating-system/process.html#clone" class="sidebar-link">clone</a></li></ul></li></ul></li><li><a href="/operating-system/context-switch.html" class="sidebar-link">上下文切换</a></li><li><a href="/operating-system/schedule.html" class="sidebar-link">进程调度</a></li><li><a href="/operating-system/ipc.html" class="sidebar-link">进程间通信</a></li><li><a href="/operating-system/process-thread.html" class="sidebar-link">同步问题</a></li><li><a href="/operating-system/deadlock.html" class="sidebar-link">死锁</a></li><li><a href="/operating-system/memory-management.html" class="sidebar-link">内存管理</a></li><li><a href="/operating-system/file-system.html" class="sidebar-link">文件系统</a></li><li><a href="/operating-system/io.html" class="sidebar-link">IO (epoll)</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="进程与线程"><a href="#进程与线程" class="header-anchor">#</a> 进程与线程</h1> <ul><li>进程：是资源分配的最小单位，一个进程可以包含多个线程。</li> <li>线程： 是程序执行的最小单元，是系统独立调度和分配CPU的基本单位。</li></ul> <p>进程是执行中的一段应用程序，即一旦程序被载入到内存准备执行，它就是一个进程；而线程就是一个单独的指令执行序列，以及与它相关的上下文，例如 PC计数器、寄存器、调用栈等。</p> <h2 id="线程"><a href="#线程" class="header-anchor">#</a> 线程</h2> <ul><li>线程（Thread）是操作系统能够进行运算调度的最小单位，它被包含在进程之中，是进程的实际运作单位。</li> <li>一条线程是进程中的单一顺序的控制流，它同时还拥有自己独立的 调用栈（call stack）、寄存器环境（register context）、线程本地存储（thread-local storage）。</li> <li>同一进程中的多个线程之间共享内存空间。特别是，它们会共享 执行的代码，动态分配的变量和非线程局部全局变量的值。</li> <li>当一个线程的上下文环境驻留在处理器的寄存器中时，表示它正在处理器上执行，此时程序计数器（PC）指示了该线程正在执行或者下一执行指令所在地址。</li> <li>特定的寄存器存储了线程相关的上下文环境，例如栈指针（stack pointer）指向调用栈顶部等。（不同的指令集体系可能会有不同）。</li> <li>寄存器需要存储的是线程的“核心”状态，其余上下文则存储在内存中。</li></ul> <h2 id="地址空间"><a href="#地址空间" class="header-anchor">#</a> 地址空间</h2> <p>地址空间 = 可访问地址集 + 与之相关的上下文状态。</p> <blockquote><p>对于一个32位操作系统，有<code>2^32 bit</code>空间，也就是4GB。</p></blockquote> <p>不同的进程拥有独立的内存空间。操作系统使用 <strong>地址转换</strong> 将进程所使用的虚拟地址转换为实际地址，将不同的进程所使用的地址转换到不同的内存块中，互相隔离，如图所示。
<img src="/assets/img/address-space.13470310.jpg" alt="address-space"></p> <h2 id="进程"><a href="#进程" class="header-anchor">#</a> 进程</h2> <p>进程的组成包括<strong>地址空间</strong>和<strong>一个或多个线程</strong>。</p> <h3 id="为什么使用进程"><a href="#为什么使用进程" class="header-anchor">#</a> 为什么使用进程？</h3> <ul><li>操作系统与用户进程之间是隔离的，用于保护操作系统。</li> <li>进程之间是相互隔离的，互相之间不受影响。</li> <li>进程提供了内存保护，每个进程都拥有自己单独的地址空间，不同的进程无法访问对方的内存空间。</li></ul> <h2 id="上下文切换"><a href="#上下文切换" class="header-anchor">#</a> 上下文切换</h2> <p>当系统中存在多个进程/线程时，如何使所有进程均得到执行时间，从而造成多个处理同时进行的错觉呢？这时便要考虑并发了。
系统在不同的进程之间来回切换处理，从而造成所有进程都在进行处理的错觉。</p> <ul><li>每个“虚拟CPU”需要一个结构来存储：PC计数器，栈指针，寄存器数据等。</li> <li>如何从一个虚拟CPU切换到另一个虚拟CPU呢？
<ul><li>在当前状态块中，保存PC，SP，和寄存器数据。</li> <li>从新的状态块中，加载PC，SP，和寄存器数据。</li></ul></li> <li>如何触发上下文切换呢？
<ul><li>Timer计数器，yield，I/O，以及其他。</li></ul></li></ul> <p>一旦涉及并发，就有一个基本问题，资源分配/共享的问题。</p> <ul><li>硬件：系统可能拥有单个的CPU，内存，I/O设备等。多个线程/进程并发时，如何使用这些资源呢？</li> <li>并发编程API：进程以为自己对共享资源有“独占”访问权限，如何保证进程顺利工作呢？</li></ul> <p>所有的这些问题，都需要操作系统来进行协调，从而使进程在并发的时候也能够顺利使用共享资源，完成自身工作。</p> <h2 id="linux-中创建进程"><a href="#linux-中创建进程" class="header-anchor">#</a> Linux 中创建进程</h2> <p>Linux 中创建进程主要提供了三种方法：fork, vfork, 和 clone。</p> <p>在 Linux 源码中，这三个调用的执行过程是：在执行 <code>fork(),vfork(),clone()</code> 时，通过一个系统调用表映射到 <code>sys_fork(),sys_vfork(),sys_clone()</code>,再在这三个函数中去调用 <code>do_fork()</code> 去做具体的创建进程工作。</p> <h3 id="fork"><a href="#fork" class="header-anchor">#</a> fork</h3> <p>fork 创建一个子进程时，子进程只是完全复制父进程的资源，复制出来的子进程有自己的 task_struct 结构和 pid,但却复制父进程其它所有的资源。例如，要是父进程打开了五个文件，那么子进程也有五个打开的文件，而且这些文件的当前读写指针也停在相同的地方。所以，这一步所做的是复制。
这样得到的子进程独立于父进程， 具有良好的并发性，但是二者之间的通讯需要通过专门的通讯机制，如：pipe，共享内存等机制， 另外通过 fork 创建子进程，需要将上面描述的每种资源都复制一个副本。这样看来，fork 是一个开销十分大的系统调用，这些开销并不是所有的情况下都是必须的，比如某进程 fork 出一个子进程后，其子进程仅仅是为了调用 exec 执行另一个可执行文件，那么在 fork 过程中对于虚存空间的复制将是一个多余的过程。
但由于现在 Linux 中是采取了 copy-on-write (COW 写时复制)技术，为了降低开销，fork 最初并不会真的产生两个不同的拷贝，因为在那个时候，大量的数据其实完全是一样的。
写时复制是在推迟真正的数据拷贝。若后来确实发生了写入，那意味着 parent 和 child 的数据不一致了，于是产生复制动作，每个进程拿到属于自己的那一份，这样就可以降低系统调用的开销。
所以有了写时复制后呢，vfork 其实现意义就不大了。</p> <p>fork()调用执行一次返回两个值，对于父进程，fork 函数返回子程序的进程号，而对于子程序，fork 函数则返回零，这就是一个函数返回两次的本质。</p> <p>在fork之后，子进程和父进程都会继续执行fork调用之后的指令。子进程是父进程的副本。它将获得父进程的数据空间，堆和栈的副本，这些都是副本，父子进程并不共享这部分的内存。也就是说，子进程对父进程中的同名变量进行修改并不会影响其在父进程中的值。但是父子进程又共享一些东西，简单说来就是程序的正文段。正文段存放着由cpu执行的机器指令，通常是read-only的。</p> <p><img src="/assets/img/fork.0681d9ca.png" alt="fork"></p> <p>fork 往往需要和 wait 一起使用。wait 函数的功能是：</p> <ul><li><p>父进程一旦调用了 wait 就立即阻塞自己，由 wait 自动分析是否当前进程的某个子进程已经退出，如果让它找到了这样一个已经变成僵尸的子进程，wait 就会收集这个子进程的信息，并把它彻底销毁后返回；如果没有找到这样一个子进程，wait就会一直阻塞在这里，直到有一个出现为止。</p></li> <li><p>僵尸进程：当父进程忘了用 wait() 函数等待已终止的子进程时,子进程就会进入一种无父进程的状态,此时子进程就是僵尸进程。</p></li> <li><p>孤儿进程：当父进程忘了用 wait() 函数等待还未终止的子进程时，子进程就会变成孤儿进程，交给 init 领养。</p></li></ul> <p>僵尸进程的示例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>
    pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;fork error:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I am child process.I am exiting.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I am father process.I will sleep two seconds\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//等待子进程先退出</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出进程信息</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;ps -o pid,ppid,state,tty,command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 此时子进程已经是僵尸进程了</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;father process is exiting.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>孤儿进程的示例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>
    <span class="token comment">//创建一个进程</span>
    pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建失败</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;fork error:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//子进程</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I am the child process.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出进程ID和父进程ID</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;pid: %d\tppid:%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I will sleep five seconds.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//睡眠5s，保证父进程先退出</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;pid: %d\tppid:%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child process is exited.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//父进程</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I am father process.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//父进程睡眠1s，保证子进程输出进程id</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;father process is  exited.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试结果如下：
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAiUAAACtCAIAAADgc5ggAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAaiUlEQVR4nO2dO3LjuBaGwXtnE5ObHbjuCugVSEocdToZVRNJSWcddtYJFYpRO3XUiagVWNGEUw5M74U3kETheQCQ4FP/V6qutkiCAA6EQxyA+P/769evP//8859//mEAAABAZ/xn6AwAAAC4C+BvAAAA9AH8DQAAgD6AvwEAANAH8DdOZGVVZsm0Up4fSVairgCYLkZ/k2RldaZIg9zpkmCZBUlNJS2qyjPHXWcJuFO3N5NHycrqbfPwsHmDyWxwP4VQv947BTUZml+/fv3999/q9508SyZZ2U1PkRa3PijJSo/+qLMsgQaYWp0wCkyLafib7poWkXJa8F1jkpVz6ChRk3NhHvG09Hnxuftre/7jtP15fPiCljEj0i9sF29Pl7/yZRRvB83PiMmXURQt88tfp228+4wfEYNsAGqyAzz9zS3KpgwxL0PPIuXOMT0PcKcIj62GpG/HipQ7r34wSZ8Xn4dzd5SVVVXtF1S2i6KQM8Yf199YifNowo31udevqBKZU6Y5X1ZmCZ9nIQW6ruTaUG8u5LrIhAdAskS2erZZgaLFA4TY2Opmqi+TVF7bURNpUVXn8B9f08oZDWrSnrKUzIYdak/tmnPv8jpgaXVkfiZZk0BHm3gaH8Wqv7g1pkSZC+dHr2kq90Wy95KbzrVhXdOsU0gvjeh6UVoQaYnD5EtzvOWq0P4YtLWh+Y4roEuJTCnTJFlZlkLMUF10QNUVf64UJpCjBmlRiYFKqkRkPVuOckXT1oZcHleE4Go9X2cqvlhey1GXextObleTDvElbjbMNbesdXkJ6FbnkrFp1SQw0Wr+RraWbG05jcv5ajtONQ+7yneGHrs+s75A9TfmoigNTltubW0kWXm+TVZei5MWdQfvUiJTyjS6CSo5aVNd0T6SrClricirLUf5vFAnXX79rn2VkmfxGShAjgmMfVnLmvSYz1CeCC0nNy6vOMiQBxt0q7MztZoEJnznb8R29bZ5kE84/s5119U8bKpqvziuhRB88hizxV5qrPsFix99Us8/PhfPmo4oX67L87KmZs/IJk7v5eI5ZUm2YrsdW2UJS58X5fvJq0TN+Dy8il/kH0pwWVdX6ZeHSwaFYnDRKuXwFXuJ6HoOY4VtHEVRtIu/OV2dPMafH0ItnN5L8RRjeR2ONqRtTXqQL6N1uXEfSTQub76MNFxmP+ytriEjrkmgxcvfpEW1Z2uuPT3tPr3veFxH0ZrtBcOf3kt2XKvt1XNaePvXLt6fW9xC6JCEX8O63LyFaTf572P8mHxdscPr64GtviaP8bWTD1QiEw9f/id+oftJ63KsuiWpUzZOibqUiK7nxlaQFqQl2cqpsLpOLXmMxVPoKeBOJojb16Qn7qXoZkLc3uoaMuKaBFp8xzf8Q3NaaMY3Nj4/csbyZXRYvXEuJ1+u2V4crnosa/73OrA5nR9/z03udEtH7PY+/J2kgfyDfXlZscPr6fR6YKuXFat/Qu1KZGWx5wuVZN/i3Q+XX+/2Z7l5EeOHL5vy5+X3mf/Ysc0L76mTc6wwYdYS0fXc1gr8pO7b6vC0dOuq8h+7eM/dN3sRWixZXstRt2zX3o6fOmhVk2TKctgnycr94vhTmua+BCnkggQorwG61TkxzpoEvvjN30hrQbJzOL2erOfHrPLfwsuVugVq0to33tia6LC6RsXQyORk9XesJ34MZRCKLSZ+va86ae9Xosp1WuJsGiEFn7qSciVbWTnsWCKinq1HpaKZCt5sgoGvkDLL5DTI8lqO2jCuIWxRk54p65qUwd+0Ly+BpdX5XD6imgS+9Pq+Z5cYlzTPjsmZxp0u/E34NAAAjaDiaZe9QybSe99CaZFjsAWMiPOzJB2gzZe3MGlDuFe1AAB9YxrfgHEivo83jUeBgRHf+EOVATAUfwydAeBHvowwevPjtI0j7H8DwPDMY/80AAAAYwf+BgAAQB/A3wAAAOgD+BsAAAB9AH/jBPSkx0D3Lx7h7RwAOgR60tj2dRSMQU86yb6NZssSKBmDOQI9aehJj4dB9aR1gxsoGQMQjnnE06AnPW/60JMe0eAGSsZgpkBPWj4OPemZ6Um7kX7fMHGLbSgZAxAa6ElDT3rGetKOKBvXCxlyugRKxgBYgZ409KTnqyftiDlvUDIGIBzQk24O9KTHriftRpOZGygZA+AP9KRbAD1pL+3e/vWk3VJXZm4cgJIxAP5AT7oN0JMeuZ70FbOipX1wAyVjAEIBPemqLgL0pHWHHUs0Wj3py5X6e9qThJIxAMGAnvTkmJxp3OleT1q+3dwbCwBjgvA399F7T49Z+hvrfjYAgMkDPelpAT1pAMBEgZ70xICeNABgosxj/zQAAABjB/4GAABAH8DfAAAA6AP4GwAAAH0AfwMAAKAPJuZvxPeu276qAT1pAADoDcXf6DZaGctrHkn2sinX/OaIjntKGfZ+P23jRluOAgAA8EbxN9dNbZ92n5+7p/P/PTdH7BJuJ2MAAAATImg8zaQ2fZX9vIll8ZrH7imLEry3aBqhcu2m3WvWk26hcm3mTjWhAQB3Tnf7dQrbqnP72mdlxW0p7dNfuUkiavQQiQtJPelWKtfWosxUExoAAPR0uD8038trRYt9t+d1lOBVT6P9jVFPup3KtS2Pc9WEBgAALWHXp1nVpjuim/uGUbk2crea0LOhGjoDAEyLgP4miNr0mO4LTeiAmtCzo2IsGjoPAEyLsOOb1mrT3d3XoN1LAk1of01os3LznICzAaAJ8vxNm/dvTGrTokzz5a8ivb1vae2b6FwRKtdXtCvBrHrS0oXnA1SmnF3RbDWh5+5vKoTRAGgM9NYGYZYanbMHngaANkxsPxsAhgIxNABaAn8zAGlxfgP17RbJA+MGzgaA9kBPegCgCT0t4GwACAL8DQBGzhM2cDYABAH+BgA9GNYAEBbM3wCgAc4GgODA3wAgA2cDQBfA33SOuvEzGDNwNgB0xOT9zVCa0K3vq9nLwITzNgygFRWcDQBdMh096ZFpQrvfdxtrha8vO1+6pAHZ6x44exo4GwC6Y2p60gB0AIY1APTAJPSku9SEdrx7fXEmD7PM9/WImKkYpaYd8gqlai/gbADoicnoSXepCU3d1KzNTN9XzLixJrVHJdUDr/kbKFUTqBtuYgtOAPpjMnrSXWpCm7DoJ1P3lc7y8jea/LkrOUOp2kQlqglAWQCAnpmHnrQZZ01oEy6Km4ERxTrP/KuRNjMCpWqaCqsDABiCGehJk7TWhDZqM3eH2MWf+d8XD98NpWoVaSgDTwNA/0xKT7p3TWhSm7k78h+7eC9ITZf7hU8CUKq2gUgaAAMwDT1pxlg3mtB+d63E6XHyvrqKvFUlfVQ+ocwSjUa2Mb9QqpaoDB8AQK9AT3pmQKlaxeRv4HIA6BPoEYCZY3IqmMIBoGcmv38a4IFSNU3EfQAAPYPxzayAUrUEBDoBGA/wN2DOwNMAMB4QTwMAANAH8DcAAAD64BZPw9pQALxAsA4AL4TxTeT82ZXVZ5a4n4/PnD6wfjTU7xWAKdNhPC20CjL/arxmqe/tFXXd9gG3N9hpUQNj8sAPf+t3ZV95SwUYF4ChqPcX6CKeFuxdd3G/NFmHRdxgX90ejdzIq04Qb+UHxsP6XdrXWX3CD8SfAfBmGv5GQUxY7lKSrBS2IqNVatLCb0c14EYb6we0L/wNACNBiKfZ1YhtGsl2FeQQu/wmWblhhy25wf5t5/zkMS7f+UPvpbBhf/ZtcfzpKk8waWj7jsf6Ye0LABgL0vjGRY2YtVFBbuNv6v5MG6Pn4y18dEYZvohakpfHXy7+P+ewGm3fga3fiX3l+ZtQYx2MbwDwRbNe4IEdeJmsbbwuN98dfqTp9025Fi6M1kflrIusVkw/veo5beOrGpfUxeTLaBdf5CXfVgfdjSmei2p1eDpLfR1Wb/N2ObR9h7R+N/YVhNyiNdvP27wAjBeNv3FRI9bQWgXZnXwZrcuN9KB66auiKIq3yWP8+fEvkQlR7XKxYOu6C9zG63L1tYtsjwTavmOwfmj7Cmn/2LHVVzgcAAZAN75ppkbcWgXZF3MvmH7fsMPrNcdKxvjOirH895Hxf88e2r7jsX4g+wIARoM6fyMFuU3Ben0EX7ww1PxNWqhikaY4PB/q1+VWXa6UCJMUuvXS84G271DW786+clLnO0GRGoBB0KwX8FIjrjxVkJuuFxAlh+XOiD+o7agsL3Nyqc87uk/bd0Drd2hfIVvBniXgbwDwRutvhs0S6A7avrC+O/A3APiC/aEBAAD0Aj++6SbwAMYCbV9Y3wuMbwDwptP9bACYK/i9AOAL4mkAAAD6AP4GAABAH8DfAAAA6IM/+D8QkgYAANARt/EN1Ign90FNDvsBAHgxnngara1iUV7p7L4DI751P8IMjo7QKuYAgHDU66Ev6DYt6fNljKFegB/jq/Va7WtgY4ymBABoxjdXtZCn3efn7iIJs8x1l4IeUDb5BwCAiRIsnlYHfm4P5PVQ6fLVcJErISxVFD6C9uJ4T77OdNRBm9khw2+bh4eN7nJjTSbSvpXy3/YSOWXMUJO2lMUdDLKs5EXVhJTVshYpd4Jmg2+ikltYHwAXsNLKFTmedqVBUEJzRSL2KQ4pdxBPE3ewTwttX+iyx76UkvWoizYzha72rHlWFRf4bNJ5tkHVpCVlnTDArXIkmQDtyfUJon6ETcfayfoANAbOxoOA/ibJyvMvOSuvXUlaOKqnBDlqQNKzd09Zlcrhv6OPyv2g8RJbnjzzrHwvJGLJsw2iJi0p0zawPanIXpE7X3Nf8V5O1gegMfA37oRcn3Z6LxfPKUuyFdvt2CpLWPq8cNCG7Jp8uS43b9pgDUnyGLPFvhLZL1j8aD/KGGuszdya0/Znufl+8YrfN+XPrVOJ7Jhr0iFlc0vQSYjKqp3H39qJLLuOdVPrA+BAhZXxPgRdD53/PsaPydcVO7y+Htjqa/IYG7qJnrkugoiiKIrW5ebN6YH+9F6y4zpSiLf2o4yxxtrMAch/HxffsoQl2bd4d1vu4ZBnW8KGmnRI2expdW5Y50g0uOhYN7M+ACA0Yd+/yT/Yl5cVO7yeTq8HtnpZseGXVymLinPh8ZciX67ZXoxocVEy+ihjjLHFXpzC+BbvfvRTIfmPHdt8L/jBDWNOeTZD1qQl5fzHjm1e+KFFco66Jowxtv1Zbl6Ea7MXKecm8h+7eC/OE+0Xjnm+0lRzFtw5GNx4E/b9G76LkabHaTXiNkftWRJxz5XmcrVLNRyltZktkFZwrA3T1DhdIgK6Ju0pS4fJmrylLK/F06zNI3SsrXnmroe/AX5g5sYb03oB0BK8dQjAjIGzacB49rMBAAAwZ+BvOiEtzi9rvmkjXQCASYOZm2b8YT8F+JMvo8EXSgAAwKjA+AYAADzA4KYx8DcAAOAKnE0b4G8AAAD0AfwNAAAYqcT/Y3DTBvib2eK9HfUImGKeweypxvq2TaX7vzar1fVf/tM/Rn8TVsk4uW4T3yoVANoBtWnQmBG6nMiWq9q11MOy6PoZBv3+Ao2VjIkt9G276wNgJFzjGfm+Dx09sVbcvy63tqLeTptz+uiYn8T5/KifIMkGOac+k8ihtsIHqVXz+zdQMgYgNNofeST+n54kqLgzpf9YexA1ccd7MeVR2vcBudNy9U/7iRyXy9VzTPflq9fdpv2jxNNoJWNp+0NhCJQWyoVqAE0ncMxfbzh4PVak3HkOD7x2XWdryiadY12uJY1ki74yrXPcXAXZptvdmb6yubxczSZ8BjR7kOpU7yztiq7nhpLe3RCJH6brGupeg3HPqnx37NJVqU+7alLMFpBRYy91nht0W0HK1TOmYo4hqy6DLame1ebXN8Z4mmNvru4BTMTT+J5ClBB20Tm+divXq9LUpZ900XU2pkzrHJMaybYS0TrHAVSQzWrTnegrWy3IV5am5VB5ptqVXfObUpseEmuXTcSd+EPaKAoR7OK/JD7q5eq/pls4Bu4alKtnuoikMSUpkwVVK7jEykZdq238jeY0n/kbWhVY/U7ng5zyaNV1NqVM6xyTSsXWEtE6xwFUkM3+pov+1tmCZUbY0d/feGt+j0RfmnYA0jnWvsmavrtv096R/08DfxOwXD3TXQdtdRvqOaZv6CcG67NIn/iuhxZDF2+bB/slDjjrHDeTC3XRddalbNc5Nqp12ktE6xx3p4LcTcpuFsyX0Y5t9vEuWgaaHLRqflvUpseFS5RDCsTRgxLicbhPwpZrKMYQQ9PCV530H/6cMVSjl79Ji2rPeNHgp12Y3257nWOSprrOdp1jo0ayS4lonePuVJC7SNnJgmlRVavD09NhFWzTbKvmt1Vtui/UDtTqKrT/YeIIg+5iHLvIytYfBY8jtSlX/4whD82oxPUX2mrvE9/xDT8MSAvt+Ob2C3efHGilc2ynqa4zrXNMaiRbSkTrHLfQwLbQWco2CyZZWe3ZOoq3p9M2jtZs7zuy0rcri+Y3rTbNp9f1tI52pYBp8rajJ9aK7DfVBCuu9w/ChJ7Ea7rwNFJMkvhTqorI4CpMlrW2q77x05OWVgJlnHLvFe1yIO7L88ma9UiEGrEmUz4qyISuszVlo86x4TBxUFKbVm6bOB6lodWm26RsxVheydpEa9DlWU3cS8eaUJsWz+h1WsdlMEHE9K0zwEQi7lM12i9dZhq0pQtSLsCj9Umm00x/9srs9aRH/n4fuE+s/sZr3th0QiWm5pKy+r3qb6zpuHgUItvW7AGm1KT6kc6kz+kH6K2BWTGhHqoflyOlFsTluKQDlxMW03tapqPqmWOYgpq5v0mLar9gjL1VG8aO62DLosCIGcPviqDuQOm3x7X9bCSeaTqnUs5U76KN+Kt5q5Q0pXNMMwf8aaHKdbfMxunO3N9A1xmMDXrG3uU0ZntipdMhriUeotX/mC6h8zCVJ3HQBdAjAAAA0AfwNwAAAPoA/gYAAEAfwN8AAADoA/gbJ7rTOYaCsjvdvUoFK9wzsH5vOOhJB9rpqmtJae41ctccQ+V6PNTtzfTLz8qzCM7bUCYLrWXA73ugabG3PRMMwg3EUfGMYD/he6aJ9bntrcAF0/4CnTxLdiYpzeup+G28BpXrMWFqdcITaFoQ9u30TYVgPwpxZ0FZR0kUyFDbM7kRX50gOrrAeFi/3iEpK4KYYTbv38wjnpY+Lz53f1220Txtfx6VXYHBlEm/sF28vW7onS9DbRw+GPkyim4vH5+28U7YiTx9XhzX18Onbfx0WPFafN9Xh7oGTtt4F38T+rS0eFsdouhWYaBvLluwx9v3oXMyMjz9DaEnfXHpRarsxkgmIzy2GjdrpFWf0+fF5+H868rKqqqULYBtCsrm2INR51gTbqzP5VUsjTETm+qzgbtUyOY3h/bAXlc2K9i1qEPs9Zlk5YYdaPdwc0fJY1wK3dh7KQhuZN8Wx58T98du0PadivXvizbxNEUVuDbxNQnJEnzwSlSDbqUnfVVxvF4kqTqSCsqkyrWYcflbWv3TpUSmlGlmrJBtrA25PEakyINLXZnu66RF3abH4easpCNyPI2vLCWcKCqWXho/N78z576Qtu/w1tfJzzZgNvG0dvM38uSH3APJaVzOF3qx64Ut9KQvZ9YXqP7GXBRK5Vo6S9Miz7c5R8vPt6o7eJcSmVKmmbFCtrU2Lt2o+Tes+htrXRnu258WtfLcxpi0XoDPi4O/Kbhv5r34irbv8NaHvxEJridtU3x+2FTVfnFcCyH4MHrS+cfn4llj3K60mU/v5eI5ZUm2YrsdW2UJS58XF91Q5xI1424VsrdxFEWRPGNB4lJXGnrUos6X0brcSP3SuaTnWYDkMf78+JfIhGi1xYKt69mbbbwuV1+7yPZIoO07fuvfFf3rSR/XUbRme6G7CaQnvf1rF+/PveBC6JA60mbOfx/jx+Trih1eXw9s9TV5jK+dPBSyAypkS0/0SbZyKuyFhnXVuxa1uRdMv2/Y4fWaYyVjvDNiLP99ZPzfs4e271Ssfyd0oCdN8/mRM5Yvo8PqjXM57fSk/70ObE78Q+Hplk432syM5R/sy8uKHV5Pp9cDW72sWN1xQyE7qEL2w4YbVa8OTz7CEg3rqkMtaimAlmTlfnH8qV8wcH7I4xeb5T/48V1abErhUsmIWbln814+QNt3fNa/a/zmbwg9aXmth/y38HKlboFaGz1p+f0bsaEol6p31KtcW3WO+Q5XDZT7laiipiVU08xSIZuev3EJoGvWC3jVVaWul+ByHE6LWqwQ2fDCSj5do7C8zKldADpHaPsOZn21ubczxGzmb/p937NL7ud16smZxp2O/E2IrIExQtt3Ntafjb+h4mmXvUMm0nvfQmlQ8Zwg5ydCOkCbL/ESIwBTxjS+AeNEfBtzGo8CfcI/CaKu5g1t3zlZfzbjG/gbMCvm88sE4MpsWvU89k8DAAAwduBvAAAA9AH8DQAAgD6AvwEAANAHnfibeW8ROB7GWc/jzBUAYHA8/E1r9WUPxZfQ2r1gPqBtADBV/NZDh1BfdnzpdzbvBoML4aS7ibYxm5WjANTMplVj/gYAAEAfaP0NpSjMGqkvu2BXbzXn9c70lW313EK52Vwiru4S/ha8EJgpV2lRVdXb5oHf5lndcdVck83aBgBgXMjxNFJRuI36Mn3USb2VSHCm+sr2gmuqqHnKVg1svjq0qpTmXFHxNPq+Xm2jwgefOX5mguRvLFvwtlBfJo+2Um+dsb4yjdnfNEvZWdW7zIza3k38DX3f/nSdAQCdoomneUgnhqK1euvd6ivraJqymwZ2vox2bLOPd8G24abvC2VfAOaCxt84qHuHprV6633pK9uL1ShlJw3stKiq1eHp6bAKtukufV8o+wIwF2R/QyoKd4ebeivBvekrm2mRsk0DO8nKas/WUbw9nbZxtGZ734Zx8xz8tBJ9Xyj7AjAXNO/fGBSFW6ovB1BvNTBjfWUtdE22SZkqkWRtojXocqUm7q69LSceVNcZANAfM9C/wZuhAAAwfvC+JwAAgD6YvL9Ji/N7hG9q9AYAAMB4+GPoDLQlX0aBluUCAADokMmPbwAAAEyC/wMrkzSk1SLM1QAAAABJRU5ErkJggg==" alt="orphan-process"></p> <h3 id="vfork"><a href="#vfork" class="header-anchor">#</a> vfork</h3> <p>vfork 系统调用不同于 fork，用 vfork 创建的子进程与父进程共享地址空间，也就是说子进程完全运行在父进程的地址空间上，如果这时子进程修改了某个变量，这将影响到父进程。</p> <p>但此处有一点要注意的是用 vfork() 创建的子进程必须显示调用 exit() 来结束，否则子进程将不能结束，而 fork() 则不存在这个情况。</p> <p>Vfork 也是在父进程中返回子进程的进程号，在子进程中返回 0。</p> <p>用 vfork 创建子进程后，父进程会被阻塞直到子进程调用 exec(exec，将一个新的可执行文件载入到地址空间并执行之)或 exit。vfork的好处是在子进程被创建后往往仅仅是为了调用 exec 执行另一个程序，因为它就不会对父进程的地址空间有任何引用，所以对地址空间的复制是多余的 ，因此通过 vfork 共享内存可以减少不必要的开销。（不过，当 fork 支持 写时复制 之后，vfork 的用处就不大了）</p> <h3 id="clone"><a href="#clone" class="header-anchor">#</a> clone</h3> <p>系统调用 fork() 和 vfork() 是无参数的，而 clone() 则带有参数。fork() 是全部复制，vfork() 是共享内存，而 clone() 是则可以将父进程资源有选择地复制给子进程，而没有复制的数据结构则通过指针的复制让子进程共享，具体要复制哪些资源给子进程，由参数列表中的 clone_flags 来决定。另外，clone() 返回的是子进程的 pid。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/operating-system/context-switch.html">
        上下文切换
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6eab1976.js" defer></script><script src="/assets/js/2.167d90c7.js" defer></script><script src="/assets/js/21.fec0ccc6.js" defer></script>
  </body>
</html>
